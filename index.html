<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>我們的愛情故事</title>

  <!-- 分享卡片與 icon -->
  <meta property="og:description" content="我們的愛情故事與共同回憶。" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="images/16.jpg" />
  <meta property="og:locale" content="zh_TW" />
  <link rel="icon" href="images/2.jpg" />

  <style>
    :root{
      --bg: #fffafa;
      --text: #4a2c2c;
      --muted: #a67f8e;
      --brand: #e91e63;
      --brand-weak: #fce4ec;
      --card: #ffffff;
      --shadow: rgba(233, 30, 99, 0.15);
      --pink-light: #ffeff6;
      --pink-dark: #d81b60;
      --gold: #e6c9a8;
    }
    :root.dark{
      --bg:#1a1015; --text:#f9e1e8; --muted:#d4a5b5;
      --brand:#ff5c8a; --brand-weak:#3a1e29; --card:#2a1924; --shadow:rgba(255, 92, 138, 0.2);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: 'Noto Sans TC', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      line-height:1.7;
      background:var(--bg);
      color:var(--text);
      position: relative;
      overflow-x: hidden;
    }
    body::before {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M50,50 C60,40 75,35 85,40 C95,45 95,60 85,70 C75,80 60,85 50,80 C40,85 25,80 15,70 C5,60 5,45 15,40 C25,35 40,40 50,50Z' fill='none' stroke='%23ffeff630' stroke-width='0.5'/%3E%3C/svg%3E");
      pointer-events: none;
      z-index: -1;
    }
    .container{max-width:960px;margin:0 auto;padding:0 20px}
    .site-header{
      background: linear-gradient(135deg, var(--brand) 0%, var(--pink-dark) 100%);
      color:#fff;
      padding: 60px 0 50px;
      text-align:center;
      position: relative;
      overflow: hidden;
    }
    .site-header::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10,3.5 C10,3.5 11,1 13,1 C15,1 16,3 16,5 C16,7 14,9 10,13 C6,9 4,7 4,5 C4,3 5,1 7,1 C9,1 10,3.5 10,3.5Z' fill='%23ffffff20'/%3E%3C/svg%3E");
      opacity: 0.3;
    }
    .site-title{
      margin:0 0 12px;
      font-weight:900;
      letter-spacing:2px;
      font-size: 2.8rem;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
      position: relative;
    }
    .site-title::after {
      content: "❤";
      position: absolute;
      font-size: 1.8rem;
      margin-left: 8px;
      animation: pulse 2s infinite;
    }
    .lead{
      margin:0;
      font-size:1.15rem;
      opacity:.95;
      font-weight: 300;
      max-width: 600px;
      margin: 0 auto;
    }
    main.container{padding:32px 0 60px}
    .card{
      background:var(--card);
      border-radius:20px;
      box-shadow:0 8px 30px var(--shadow);
      padding:28px;
      margin:24px 0;
      position: relative;
      border: 1px solid rgba(233, 30, 99, 0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 40px var(--shadow);
    }
    .card::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--brand), var(--gold));
      border-radius: 20px 20px 0 0;
    }
    h2 {
      color: var(--brand);
      font-weight: 700;
      margin-top: 0;
      position: relative;
      display: inline-block;
    }
    h2::after {
      content: "";
      position: absolute;
      bottom: -8px;
      left: 0;
      width: 40px;
      height: 3px;
      background: var(--brand);
      border-radius: 3px;
    }
    .sub{
      color:var(--muted);
      margin-top:4px;
      font-size: 0.95rem;
    }
    .gallery{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(200px,1fr));
      gap:16px;
      margin-top:16px;
    }
    .g-item{
      display:block;
      border-radius:16px;
      overflow:hidden;
      position: relative;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
    }
    .g-item::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(to bottom, transparent 60%, rgba(0,0,0,0.4));
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 1;
    }
    .g-item img{
      width:100%;
      height:200px;
      object-fit:cover;
      display:block;
      transition:transform .5s ease;
    }
    .g-item:focus, .g-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    }
    .g-item:focus::before, .g-item:hover::before {
      opacity: 1;
    }
    .g-item:focus img,.g-item:hover img{
      transform:scale(1.05);
    }
    .anniv-list{
      list-style:none;
      padding:0;
      margin:12px 0 0;
    }
    .anniv-list li{
      padding:14px 16px;
      border-left:4px solid var(--brand);
      background:var(--brand-weak);
      border-radius:12px;
      margin:12px 0;
      transition: transform 0.2s ease;
      position: relative;
      overflow: hidden;
    }
    .anniv-list li::before {
      content: "❤";
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--brand);
      opacity: 0.3;
      font-size: 1.5rem;
    }
    .anniv-list li:hover {
      transform: translateX(5px);
    }
    textarea, input{
      width:100%;
      border:1px solid #e8d1da;
      background:var(--bg);
      color:var(--text);
      border-radius:12px;
      padding:14px 16px;
      resize:vertical;
      font-family: inherit;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    textarea:focus, input:focus {
      outline: none;
      border-color: var(--brand);
      box-shadow: 0 0 0 3px rgba(233, 30, 99, 0.1);
    }
    .actions{
      display:flex;
      gap:12px;
      align-items:center;
      margin-top:16px;
      flex-wrap:wrap;
    }
    .btn{
      appearance:none;
      border:none;
      background: linear-gradient(135deg, var(--brand) 0%, var(--pink-dark) 100%);
      color:#fff;
      padding:12px 24px;
      border-radius:999px;
      cursor:pointer;
      font-weight:700;
      box-shadow: 0 4px 12px rgba(233, 30, 99, 0.3);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    .btn::before {
      content: "";
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: all 0.6s ease;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(233, 30, 99, 0.4);
    }
    .btn:hover::before {
      left: 100%;
    }
    .btn-ghost{
      background:transparent;
      color:var(--brand);
      outline:2px solid var(--brand);
      box-shadow: none;
    }
    .btn-ghost:hover {
      background: var(--brand-weak);
    }
    .save-status{
      color:var(--muted);
      font-size:.9rem;
    }
    .lightbox{
      border:none;
      padding:0;
      background:transparent;
      max-width:90vw;
      border-radius: 16px;
      overflow: hidden;
    }
    .lightbox::backdrop{
      background:rgba(0,0,0,.8);
      backdrop-filter: blur(4px);
    }
    .lightbox img{
      max-width:90vw;
      max-height:80vh;
      border-radius:12px;
      display:block;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    }
    .lightbox-close{
      position:fixed;
      top:20px;
      right:20px;
      font-size:28px;
      width:50px;
      height:50px;
      border-radius:50%;
      border:none;
      cursor:pointer;
      background: rgba(255,255,255,0.1);
      color: white;
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
    }
    .lightbox-close:hover {
      background: rgba(255,255,255,0.2);
      transform: scale(1.1);
    }
    .site-footer{
      text-align:center;
      padding:40px 0 60px;
      color:var(--muted);
      position: relative;
    }
    .site-footer::before {
      content: "";
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100px;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--brand), transparent);
    }
    #next-anniv-days {
      font-size: 3rem;
      font-weight: 800;
      color: var(--brand);
      display: block;
      margin: 10px 0;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    #draw-result {
      text-align: center;
      padding: 20px 0;
    }
    #draw-img {
      max-width: 100%;
      border-radius: 16px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
      transition: all 0.5s ease;
      display: none;
    }
    #draw-caption {
      font-style: italic;
      margin-top: 16px;
      font-size: 1.1rem;
      color: var(--brand);
    }
    .floating-hearts {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
      overflow: hidden;
    }
    .heart {
      position: absolute;
      opacity: 0;
      color: rgba(233, 30, 99, 0.5);
      font-size: 20px;
      animation: float 15s infinite linear;
    }
    @keyframes float {
      0% {
        transform: translateY(100vh) rotate(0deg);
        opacity: 0;
      }
      10% {
        opacity: 0.7;
      }
      90% {
        opacity: 0.5;
      }
      100% {
        transform: translateY(-100px) rotate(360deg);
        opacity: 0;
      }
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }
    @media (prefers-reduced-motion: reduce){
      *{transition:none!important;animation:none!important}
    }
    @media (max-width: 768px) {
      .site-title { font-size: 2.2rem; }
      .gallery { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); }
      .card { padding: 20px; }
    }
  </style>
</head>
<body>
  <!-- 漂浮愛心背景 -->
  <div class="floating-hearts" id="floating-hearts"></div>

  <header class="site-header">
    <div class="container">
      <h1 class="site-title">我們的愛情故事</h1>
      <p class="lead">
        從 <time id="start-date" data-start="2025-01-09">2025-01-09</time> 開始，
        我們已經一起走過 <span id="day-counter">0</span> 天 ❤
      </p>
    </div>
  </header>

  <main class="container">
    <section class="card" aria-labelledby="photos-title">
      <h2 id="photos-title">照片回顧</h2>
      <p class="sub">點擊圖片可放大瀏覽我們的甜蜜時刻</p>
      <div class="gallery" id="gallery">
      
      </div>
    </section>

    <!-- 倒數：下一個紀念日 -->
    <section class="card" aria-labelledby="countdown-title">
      <h2 id="countdown-title">下一個紀念日倒數</h2>
      <p class="sub">距離 <strong id="next-anniv-name">—</strong> 還有</p>
      <span id="next-anniv-days">—</span>
      <p class="sub">日期：<span id="next-anniv-date">—</span></p>
    </section>

    <!-- 抽卡：隨機回憶 -->
    <section class="card" aria-labelledby="draw-title">
      <h2 id="draw-title">抽一張回憶</h2>
      <p class="sub">點擊按鈕，隨機回味我們的美好瞬間</p>
      <div class="actions">
        <button id="draw-btn" class="btn">抽卡！</button>
      </div>
      <div id="draw-result" style="margin-top:12px">
        <img id="draw-img" alt="隨機回憶" style="max-width:100%;border-radius:12px;display:none">
        <p id="draw-caption" class="sub" style="margin-top:8px"></p>
      </div>
    </section>

    <section class="card" aria-labelledby="anniv-title">
      <h2 id="anniv-title">重要紀念日</h2>
      <p class="sub">記錄我們愛情旅程中的每一個重要時刻</p>
      <ul id="anniv-list" class="anniv-list" aria-live="polite"></ul>
    </section>

    <!-- Email 寄送表單 
    <section class="card" aria-labelledby="mail-title">
      <h2 id="mail-title">寄一封小信給你 ❤</h2>
      <p class="sub">寫下你的心意，讓我感受到你的愛</p>
      <form id="love-form" action="*" method="POST">
        <input type="text" name="name" placeholder="你的名字" required
              style="padding:12px 16px;border-radius:12px;border:1px solid #e8d1da;margin:8px 0;display:block;width:100%">
        <input type="email" name="_replyto" placeholder="你的Email（回信用）" required
              style="padding:12px 16px;border-radius:12px;border:1px solid #e8d1da;margin:8px 0;display:block;width:100%">
        <textarea name="message" placeholder="想說的話…" required rows="4"
                style="padding:12px 16px;border-radius:12px;border:1px solid #e8d1da;margin:8px 0;display:block;width:100%"></textarea>
        <button type="submit" class="btn">送出我的心意</button>
      </form>
      <p id="form-status" class="sub" style="margin-top:12px"></p>
    </section>-->
  </main>

  <footer class="site-footer">
    <div class="container">
      <p>為我們製作 by <span id="author">帥文</span> · <a href="#" id="toggle-theme">切換主題</a></p>
    </div>
  </footer>

  <dialog id="lightbox" class="lightbox" aria-label="圖片預覽">
    <img id="lightbox-img" alt="放大圖片" />
    <button id="lightbox-close" class="lightbox-close" aria-label="關閉">×</button>
  </dialog>

  <script>
  (function () {
  // ===== 基本設定 =====
  const TOTAL_PHOTOS = 16; // 抽卡用的總數（1.jpg ~ 16.jpg）
  const CAPTIONS = {
    "images/2.jpg": "第一次旅行合照",
    "images/5.jpg": "生日紀念日",
    "images/11.jpg": "聖誕節交換禮物"
  };
  const ANNIVERSARIES = [
    { date: "2025-01-09", title: "在一起" },
    { date: "2025-02-14", title: "情人節" },
    { date: "2025-05-20", title: "520" },
    { date: "2025-12-25", title: "聖誕節" }
  ];

  // ===== 小工具 =====
  const $  = (sel, root=document) => root.querySelector(sel);
  const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
  const pad2 = n => (n<10 ? "0"+n : ""+n);

  // ===== 漂浮愛心效果 =====
  (function() {
    const container = $("#floating-hearts");
    if (!container) return;
    
    const createHeart = () => {
      const heart = document.createElement("div");
      heart.className = "heart";
      heart.innerHTML = "❤";
      heart.style.left = `${Math.random() * 100}%`;
      heart.style.animationDuration = `${15 + Math.random() * 15}s`;
      heart.style.fontSize = `${12 + Math.random() * 20}px`;
      container.appendChild(heart);
      
      setTimeout(() => {
        heart.remove();
      }, 30000);
    };
    
    // 初始創建一些愛心
    for (let i = 0; i < 15; i++) {
      setTimeout(() => createHeart(), i * 500);
    }
    
    // 定期創建新愛心
    setInterval(createHeart, 1000);
  })();

  // ===== 天數計算 =====
  (function () {
    const el = $("#start-date");
    if (!el) return;
    const start = new Date((el.getAttribute("data-start") || el.textContent.trim()) + "T00:00:00");
    const today = new Date();
    const days = Math.floor((today - start) / (1000*60*60*24));
    $("#day-counter").textContent = String(days);
  })();

  // ===== 相簿自動載入（你刻意用 5~12，保留） =====
  (function () {
    const g = $("#gallery");
    if (!g) return;
    const fr = document.createDocumentFragment();
    for (let i = 5; i <= 12; i++) {
      const path = `images/${i}.jpg`;
      const a = document.createElement("a");
      a.href = path;
      a.className = "g-item";
      const img = document.createElement("img");
      img.src = path;
      img.alt = CAPTIONS[path] || `回憶照片 ${i}`;
      img.loading = "lazy";
      a.appendChild(img);
      fr.appendChild(a);
    }
    g.appendChild(fr);
  })();

  // ===== 紀念日渲染 =====
  (function () {
    const list = $("#anniv-list");
    if (!list) return;
    ANNIVERSARIES
      .slice().sort((a,b)=>a.date.localeCompare(b.date))
      .forEach(x => {
        const li = document.createElement("li");
        li.textContent = `${x.date}：${x.title}`;
        list.appendChild(li);
      });
  })();

  // ===== 下一個紀念日倒數 =====
  (function () {
    const nameEl = $("#next-anniv-name");
    const daysEl = $("#next-anniv-days");
    const dateEl = $("#next-anniv-date");
    if (!nameEl || !daysEl || !dateEl) return;

    const today = new Date();
    const candidates = ANNIVERSARIES.map(a => {
      const [,m,d] = a.date.split("-").map(Number);
      const thisYear = new Date(today.getFullYear(), m-1, d);
      const nextYear = new Date(today.getFullYear()+1, m-1, d);
      const target = (thisYear >= new Date(today.getFullYear(), today.getMonth(), today.getDate())) ? thisYear : nextYear;
      return { title: a.title, date: target };
    }).sort((x,y)=> x.date - y.date);

    const next = candidates[0];
    const diffDays = Math.ceil((next.date - today) / (1000*60*60*24));
    nameEl.textContent = next.title;
    dateEl.textContent = `${next.date.getFullYear()}-${pad2(next.date.getMonth()+1)}-${pad2(next.date.getDate())}`;
    daysEl.textContent = diffDays;
  })();

  // ===== 燈箱（左右切換） =====
  (function () {
    const lightbox = $("#lightbox");
    const lightboxImg = $("#lightbox-img");
    const closeBtn = $("#lightbox-close");
    let currentIndex = -1;

    const items = $$("#gallery a.g-item");
    const openAt = (idx) => {
      currentIndex = (idx + items.length) % items.length;
      const href = items[currentIndex].getAttribute("href");
      lightboxImg.src = href;
      if (typeof lightbox.showModal === "function") lightbox.showModal();
      else lightbox.setAttribute("open","");
    };

    items.forEach((a, idx) => {
      a.addEventListener("click", e => { e.preventDefault(); openAt(idx); });
    });
    closeBtn.addEventListener("click", () => lightbox.close());
    lightbox.addEventListener("click", e => { if (e.target === lightbox) lightbox.close(); });
    document.addEventListener("keydown", e => {
      if (!lightbox.open) return;
      if (e.key === "Escape") lightbox.close();
      if (e.key === "ArrowRight") openAt(currentIndex+1);
      if (e.key === "ArrowLeft") openAt(currentIndex-1);
    });
  })();

  // ===== 抽卡（從 1.jpg ~ TOTAL_PHOTOS.jpg 隨機抽） =====
  (function () {
    const btn = $("#draw-btn");
    const img = $("#draw-img");
    const cap = $("#draw-caption");
    if (!btn || !img || !cap) return;

    const pool = Array.from({length: TOTAL_PHOTOS}, (_,i)=> `images/${i+1}.jpg`);
    const draw = () => {
      const pick = pool[Math.floor(Math.random() * pool.length)];
      img.src = pick;
      img.style.display = "block";
      // 添加動畫效果
      img.style.opacity = "0";
      img.style.transform = "scale(0.8)";
      
      setTimeout(() => {
        img.style.transition = "all 0.5s ease";
        img.style.opacity = "1";
        img.style.transform = "scale(1)";
      }, 10);
      
      cap.textContent = CAPTIONS[pick] || "小小的回憶片段";
    };
    btn.addEventListener("click", draw);
  })();

  // ===== 主題切換 =====
  (function(){
    const KEY='our-theme';
    const apply = mode => document.documentElement.classList.toggle('dark', mode==='dark');
    const saved = localStorage.getItem(KEY);
    if(saved) apply(saved);
    const toggle = $('#toggle-theme');
    if (toggle) {
      toggle.addEventListener('click', e=>{
        e.preventDefault();
        const nowDark = !document.documentElement.classList.contains('dark');
        const mode = nowDark ? 'dark' : 'light';
        apply(mode); localStorage.setItem(KEY, mode);
      });
    }
  })();
})();

// ===== 寄信 (Formspree) =====
(function(){
  const form = document.getElementById("love-form");
  const status = document.getElementById("form-status");

  if(form){
    form.addEventListener("submit", async function(e){
      e.preventDefault();
      if (form.action === "*" || !form.action.startsWith("https://")) {
        status.textContent = "請先把 form action 換成你的 Formspree endpoint 才能寄信。";
        return;
      }
      const data = new FormData(form);
      try {
        const res = await fetch(form.action, {
          method: form.method || "POST",
          body: data,
          headers: { 'Accept': 'application/json' }
        });
        if(res.ok){
          status.textContent = "寄送成功！💌";
          form.reset();
        } else {
          status.textContent = "寄送失敗，請再試一次。";
        }
      } catch(err){
        status.textContent = "寄送錯誤：" + err.message;
      }
    });
  }
})();
  </script>
</body>
</html>